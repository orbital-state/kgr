# can be referenced as: 
#   <environment>/<namespace>/<kind>:<name>
#   which is "dev/web/component:web-app"
name: web-app
kind: component
extends: base/component/web-app
metadata:
  namespace: web
  environment: dev
  labels:
    app: web-app
requires: 
  # Upstream components
  - name: component/database
    state:
      - created
      - deployed
  - name: component/kubernetes
    state:
      - created
      - initialized
      - ready
implements:
  # Workflow as list of actions in fixed order
  - name: create
    tool: terraform
    parameters:
      path:  # always relative to the component path
        - "../terraform/app/main.tf"
      image: "nginx:latest"
      replicas: "3"
    pass: created
  - name: deploy
    tool: helm
    parameters:
      environment: production
      version: "1.0.0"
    pass: deployed
satisfies:
  # Tests as list of actions in parallel or in any order
  - name: test
    tool: http
    parameters:
      url: "http://localhost:8080"
      method: GET
      status: 200
      body: "OK"
      headers:
        - key: Content-Type
          value: application/json
    pass: tested
supports:
  # Downstream components
  - name: component/web-ui
    fails: broken_api
# TODO: add recovery strategy "rollback" or "recreate", "redeploy" or "retest" or "swap to another version deep in history"